<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.devdotdone.ddd.dao.RetrospecDao">
  <insert id="insertRetrospec" parameterType="RetrospecRequest">
    <selectKey keyProperty="retroId" resultType="int" order="BEFORE"> 
      SELECT seq_retrospec_retroId.NEXTVAL FROM dual 
    </selectKey> 
    INSERT INTO retrospec ( retro_id, project_id, user_id, retrospecTitle, retrospecContent, retrospecTemplateType, retrospecCategory, retrospecStartAt, retrospecEndAt)
    VALUES ( #{retroId}, #{projectId}, #{userId}, #{retrospecTitle}, #{retrospecContent}, #{retrospecTemplateType}, #{retrospecCategory}, #{retrospecStartAt}, #{retrospecEndAt})
  </insert>
  
  <!-- 회고 상세페이지 -->
  <select id="selectByretroId" resultType="Retrospec">
    SELECT * FROM retrospec WHERE retro_id=#{retroId}
  </select>

  <!-- 프로젝트별 회고 목록 조회 -->
   <select id="selectByProject" resultType="Retrospec">
     SELECT * FROM retrospec
     WHERE project_id=#{projectId}
     ORDER BY retrospecStartAt DESC
   </select>

  <!-- 회고 수정 -->
   <update id="updateRetrospec" parameterType="RetrospecRequest">
    UPDATE retrospec
    SET retrospecTitle = #{retrospecTitle},
        retrospecContent = #{retrospecContent},
        retrospecTemplateType = #{retrospecTemplateType},
        retrospecCategory = #{retrospecCategory},
        retrospecStartAt = #{retrospecStartAt},
        retrospecEndAt = #{retrospecEndAt}
    WHERE retro_id=#{retroId}
      AND project_id=#{projectId}
      AND user_id=#{userId}
   </update>

  <!-- 회고 삭제 -->
   <delete id="deleteRetrospec" parameterType="map">
    DELETE FROM retrospec 
    WHERE retro_id=#{retroId}
      AND project_id=#{projectId}
      AND user_id=#{userId}
   </delete>
</mapper>